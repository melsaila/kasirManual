"use strict";
var jCustomers = (function() {
    var hd = "",
        v = false,
        s = "",
        pmsg = "",
        grid = "#gcustomers",
        kx = "",
        objs = "";

    function init(x) {
        hd = new Gtaxi();
        hd.setkey(x);
    }

    function rd() {
        if(hd instanceof Gtaxi){
            return hd;
        }else{
            return undefined;
        }
    }
    return {
        init: function(x) {
            init(x);
        },
        grid: function() {
            $(grid).datagrid({
                url: rd().site_url("customers/selects"),
                nowrap: true,
                singleSelect: true,
                rownumbers: true,
                fit: true,
                striped: true,
                autoRowHeight: false,
                pagination: true,
                fitColumns: false,
                method: "post",
                halign: "center",
                queryParams: {
                    'taxixkey': rd().getkey()
                },
                columns: [
                    [{
                        halign: "center",
                        field: "id_customer",
                        title: "ID Pelanggan",
                        width: 100
                    }, {
                        halign: "center",
                        field: "imei",
                        title: "IMEI"
                    }, {
                        halign: "center",
                        field: "name",
                        title: "Nama"
                    }, {
                        halign: "center",
                        field: "mobile_number",
                        title: "Telepon",
                        width: 150
                    }]
                ]
            });
        },
        dlginsert: function() {
            rd().opndlg("#dlgicustomer", "Daftar Pelanggan");
            document.forms['fccustomer'].reset();
        },
        insert: function(u) {
            v = $('#fccustomer').form('validate');
            if (v) {
                objs = $('form[id="fccustomer"]').serialize() + '&taxixkey=' + rd().getkey();
                rd().sendto(u, objs).done(function(rsp) {
                    pmsg = $.parseJSON(rsp);
                    if (pmsg.result == 'success') {
                        rd().messageok('Customer Register', pmsg.message);
                        rd().clsdlg("#dlgicustomer");
                        rd().rload(grid);
                    } else {
                        rd().messagebad('Customer Register', pmsg.message);
                    }
                }).fail(function() {
                    rd().messagebad('Customer Register', 'Errors occured.Proccess terminated');
                });
            }
        },
        dlgupt: function() {
            s = $(grid).datagrid('getSelected');
            if (s) {
                document.forms['fecustomer'].reset();
                rd().opndlg("#dlgecustomer", "Edit Customer " + s.name);
                $("#fecustomer").form("load", s);
            } else {
                $.messager.alert('Info', 'Please select/choice one data first');
            }
        },
        update: function(u) {
            v = $('#fecustomer').form('validate');
            if (v) {
                objs = $('form[id="fecustomer"]').serialize() + '&taxixkey=' + rd().getkey();
                rd().sendto(u, objs).done(function(rsp) {
                    pmsg = $.parseJSON(rsp);
                    if (pmsg.result == 'success') {
                        rd().messageok('Edit Pelanggan', pmsg.message);
                        rd().clsdlg("#dlgecustomer");
                        rd().rload(grid);
                    } else {
                        rd().messagebad('Edit Pelanggan', pmsg.message);
                    }
                }).fail(function() {
                    rd().messagebad('Edit Pelanggan', 'Errors occured.Proccess terminated');
                });
            }
        },
        del: function(u) {
            s = $(grid).datagrid("getSelected");
            if (s) {
                $.messager.confirm("Hapus Pelanggan - Konfirmasi", "Yakin akan menghapus : " + s.name + " ?", function(c) {
                    if (c) {
                        objs = new Object({
                            'id_customer': s.id_customer,
                            'taxixkey': rd().getkey()
                        });
                        rd().sendto(u, objs).done(function(d) {
                            pmsg = $.parseJSON(d);
                            if (pmsg.result == "success") {
                                rd().messageok("Hapus Pelanggan", pmsg.message);
                                rd().rload(grid);
                            } else {
                                rd().messagebad('Hapus Pelanggan', pmsg.message);
                            }
                        }).fail(function() {
                            rd().messagebad('Hapus Pelanggan', 'Errors occured.Proccess terminated');
                        });
                    }
                });
            }
        }
    }
})();

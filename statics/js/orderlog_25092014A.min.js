"use strict";
var jOrderlog = (function() {
    var hd = "",
        grid = '#gorderlog';

    function init(x) {
        hd = new Gtaxi();
        hd.setkey(x);
    }

    function rd() {
        if (hd instanceof Gtaxi) {
            return hd;
        } else {
            return undefined;
        }
    }
            function a(d, e, g) {
        $(grid).datagrid("load", {
            search : e,
            keyword : g,
            'taxixkey' : rd().getkey()
        });
        setTimeout(function () {
            $('tr>td:contains("' + g + '")').css({
                background : "yellow",
                color : "black",
                "font-weight" : "bold"
            })
        }, 1000)
    }
    function dosearch(g, o, l, d) {
        var n = "",
        b = 1500,
        k = "",
        j = "",
        h = "",
        i = "",
        f = null,
        j = document.getElementById(g),
        h = document.getElementById(o),
        i = d || "1";
        j.onchange = function () {
            h.value = "";
            k = j.options[j.selectedIndex].value;
            if (k == "") {
                return
            }
            h.onkeyup = function () {
                this.value = this.value.toUpperCase().replace(/[^A-Z0-9\s\.\_\-]/g, "");
                f = this.value.toUpperCase().replace(/[^A-Z0-9\s\.\_\-]/g, "");
                if (parseInt(f.length) > parseInt(i)) {
                    clearTimeout(n);
                    n = setTimeout(function () {
                            a(l, k, f)
                        }, b)
                } else {
                    return
                }
            };
            h.keydown = function () {
                clearTimeout(n)
            }
        }
    }
    return {
        init: function(a) {
            init(a);
        },
        searchgrid : function () {
            dosearch("terminalsearch", "terminalkeyword", "gorderlog","0");
        },
        grid: function() {
            $(grid).datagrid({
                url: rd().site_url("orderlog/selects"),
                nowrap: true,
                singleSelect: true,
                rownumbers: true,
                fit: true,
                striped: true,
                autoRowHeight: false,
                pagination: true,
                fitColumns: false,
                method: "post",
                halign: "center",
                queryParams: {
                    'taxixkey': rd().getkey()
                },
                columns: [
                    [{
                        halign: "center",
                        field: "name",
                        title: "Nama"
                    }, {
                        halign: "center",
                        field: "addrs_pickup",
                        title: "Alamat"
                    }, {
                        halign: "center",
                        field: "addrs_clue",
                        title: "Alamat Clue"
                    }, {
                        halign: "center",
                        field: "phone_number",
                        title: "Telepon"
                    }, {
                        halign: "center",
                        field: "rc",
                        align: "center",
                        title: "Status"
                    }, {
                        halign: "center",
                        field: "cause",
                        title: "Deskripsi"
                    }, {
                        halign: "center",
                        field: "time_req",
                        title: "Request Time"
                    }, {
                        halign: "center",
                        field: "time_rsp",
                        title: "Response Time"
                    }, {
                        halign: "center",
                        field: "taxi_number",
                        title: "Kode Taksi"
                    }]
                ]
            });
        }
    }
})();
$(function () {
    jOrderlog.init('keys');
    jOrderlog.grid();
    jOrderlog.searchgrid()
});
